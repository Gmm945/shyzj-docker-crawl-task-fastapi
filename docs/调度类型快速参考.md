# è°ƒåº¦ç±»å‹å¿«é€Ÿå‚è€ƒ

## ğŸ“‹ æ‰€æœ‰æ”¯æŒçš„è°ƒåº¦ç±»å‹

ç³»ç»Ÿå®Œæ•´æ”¯æŒä»¥ä¸‹ **7 ç§**è°ƒåº¦ç±»å‹ï¼š

| # | è°ƒåº¦ç±»å‹ | æšä¸¾å€¼ | é…ç½®å‚æ•° | ç¤ºä¾‹ |
|---|---------|--------|---------|------|
| 1 | **ç«‹å³æ‰§è¡Œ** | `immediate` | æ—  | `{}` |
| 2 | **å®šæ—¶æ‰§è¡Œ** | `scheduled` | `datetime` | `{"datetime": "2025-10-15 14:30:00"}` |
| 3 | **åˆ†é’Ÿçº§è°ƒåº¦** | `minutely` | `interval` | `{"interval": 5}` - æ¯5åˆ†é’Ÿ |
| 4 | **å°æ—¶çº§è°ƒåº¦** | `hourly` | `interval` | `{"interval": 2}` - æ¯2å°æ—¶ |
| 5 | **æ¯æ—¥è°ƒåº¦** | `daily` | `time` | `{"time": "09:00:00"}` - æ¯å¤©9ç‚¹ |
| 6 | **å‘¨è°ƒåº¦** | `weekly` | `days`, `time` | `{"days": [1,3,5], "time": "09:00:00"}` |
| 7 | **æœˆè°ƒåº¦** | `monthly` | `dates`, `time` | `{"dates": [1,15], "time": "09:00:00"}` |

---

## ğŸ”§ API è°ƒç”¨ç¤ºä¾‹

### 1. æ¯ 5 åˆ†é’Ÿæ‰§è¡Œï¼ˆé«˜é¢‘é‡‡é›†ï¼‰

```bash
curl -X POST "http://localhost:8089/api/v1/scheduler/" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "task_id": "your-task-uuid",
    "schedule_type": "minutely",
    "schedule_config": {"interval": 5}
  }'
```

**é€‚ç”¨åœºæ™¯**ï¼š
- è‚¡ç¥¨ä»·æ ¼ç›‘æ§
- å®æ—¶æ•°æ®é‡‡é›†
- ç³»ç»ŸçŠ¶æ€ç›‘æ§

---

### 2. æ¯ 2 å°æ—¶æ‰§è¡Œï¼ˆå®šæœŸåŒæ­¥ï¼‰

```bash
curl -X POST "http://localhost:8089/api/v1/scheduler/" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "task_id": "your-task-uuid",
    "schedule_type": "hourly",
    "schedule_config": {"interval": 2}
  }'
```

**é€‚ç”¨åœºæ™¯**ï¼š
- æ•°æ®åŒæ­¥
- å®šæœŸå¤‡ä»½
- å‘¨æœŸæ€§æ£€æŸ¥

---

### 3. æ¯å¤©å›ºå®šæ—¶é—´æ‰§è¡Œï¼ˆæ—¥å¸¸ä»»åŠ¡ï¼‰

```bash
curl -X POST "http://localhost:8089/api/v1/scheduler/" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "task_id": "your-task-uuid",
    "schedule_type": "daily",
    "schedule_config": {"time": "09:00:00"}
  }'
```

**é€‚ç”¨åœºæ™¯**ï¼š
- æ¯æ—¥æ•°æ®æŠ¥è¡¨
- æ¯æ—¥æ•°æ®æ±‡æ€»
- æ¯æ—¥æ¸…ç†ä»»åŠ¡

---

### 4. æ¯å‘¨å›ºå®šæ—¶é—´æ‰§è¡Œï¼ˆå‘¨æœŸæŠ¥è¡¨ï¼‰

```bash
curl -X POST "http://localhost:8089/api/v1/scheduler/" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "task_id": "your-task-uuid",
    "schedule_type": "weekly",
    "schedule_config": {
      "days": [1, 3, 5],
      "time": "09:00:00"
    }
  }'
```

**é€‚ç”¨åœºæ™¯**ï¼š
- å·¥ä½œæ—¥é‡‡é›†ï¼ˆå‘¨ä¸€åˆ°å‘¨äº”ï¼‰
- å‘¨æŠ¥ç”Ÿæˆ
- å®šæœŸæ•°æ®åˆ†æ

---

### 5. æ¯æœˆå›ºå®šæ—¥æœŸæ‰§è¡Œï¼ˆæœˆåº¦ä»»åŠ¡ï¼‰

```bash
curl -X POST "http://localhost:8089/api/v1/scheduler/" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "task_id": "your-task-uuid",
    "schedule_type": "monthly",
    "schedule_config": {
      "dates": [1, 15],
      "time": "10:00:00"
    }
  }'
```

**é€‚ç”¨åœºæ™¯**ï¼š
- æœˆåº¦æŠ¥è¡¨
- è´¦å•æ•°æ®é‡‡é›†
- æœˆåº¦æ•°æ®å½’æ¡£

---

## âš™ï¸ è°ƒåº¦æ—¶é—´é—´éš”å»ºè®®

| è°ƒåº¦ç±»å‹ | æœ€å°é—´éš” | æ¨èé—´éš” | è¯´æ˜ |
|---------|---------|---------|------|
| `minutely` | 1 åˆ†é’Ÿ | 5-10 åˆ†é’Ÿ | Celery Beat æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ |
| `hourly` | 1 å°æ—¶ | 2-6 å°æ—¶ | æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ |
| `daily` | 1 å¤© | 1 å¤© | å›ºå®šæ—¶é—´ç‚¹æ‰§è¡Œ |
| `weekly` | 1 å‘¨ | 1 å‘¨ | æ”¯æŒå¤šå¤©é…ç½® |
| `monthly` | 1 æœˆ | 1 æœˆ | æ”¯æŒå¤šä¸ªæ—¥æœŸ |

---

## ğŸ“Š è°ƒåº¦ç±»å‹é€‰æ‹©å†³ç­–æ ‘

```
éœ€è¦è°ƒåº¦ä»»åŠ¡ï¼Ÿ
â”‚
â”œâ”€ åªæ‰§è¡Œä¸€æ¬¡ï¼Ÿ
â”‚  â””â”€ ä½¿ç”¨ scheduledï¼ˆæŒ‡å®šæ—¶é—´æ‰§è¡Œï¼‰
â”‚
â”œâ”€ é«˜é¢‘æ‰§è¡Œï¼ˆåˆ†é’Ÿçº§ï¼‰ï¼Ÿ
â”‚  â””â”€ ä½¿ç”¨ minutelyï¼ˆæ¯Nåˆ†é’Ÿï¼‰
â”‚
â”œâ”€ ä¸­é¢‘æ‰§è¡Œï¼ˆå°æ—¶çº§ï¼‰ï¼Ÿ
â”‚  â””â”€ ä½¿ç”¨ hourlyï¼ˆæ¯Nå°æ—¶ï¼‰
â”‚
â”œâ”€ æ¯å¤©å›ºå®šæ—¶é—´ï¼Ÿ
â”‚  â””â”€ ä½¿ç”¨ dailyï¼ˆæ¯å¤©HH:MM:SSï¼‰
â”‚
â”œâ”€ æ¯å‘¨å›ºå®šå‡ å¤©ï¼Ÿ
â”‚  â””â”€ ä½¿ç”¨ weeklyï¼ˆå‘¨ä¸€åˆ°å‘¨æ—¥ï¼‰
â”‚
â””â”€ æ¯æœˆå›ºå®šæ—¥æœŸï¼Ÿ
   â””â”€ ä½¿ç”¨ monthlyï¼ˆæ¯æœˆ1-31å·ï¼‰
```

---

## âš ï¸ é‡è¦æç¤º

1. **å”¯ä¸€æ€§çº¦æŸ**ï¼šæ¯ä¸ªä»»åŠ¡åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªæ´»è·ƒçš„è°ƒåº¦é…ç½®
2. **æ—¶åŒºè®¾ç½®**ï¼šç³»ç»Ÿé»˜è®¤ä½¿ç”¨ `Asia/Shanghai` æ—¶åŒº
3. **æ‰§è¡Œå»¶è¿Ÿ**ï¼šCelery Beat æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼Œå¯èƒ½æœ‰ 0-60 ç§’å»¶è¿Ÿ
4. **é…ç½®éªŒè¯**ï¼šåˆ›å»ºè°ƒåº¦æ—¶ä¼šè‡ªåŠ¨éªŒè¯é…ç½®çš„æœ‰æ•ˆæ€§
5. **è‡ªåŠ¨æ›´æ–°**ï¼šæ‰§è¡Œåä¼šè‡ªåŠ¨æ›´æ–° `next_run_time`

---

## ğŸ” éªŒè¯è°ƒåº¦é…ç½®

æŸ¥è¯¢æ•°æ®åº“éªŒè¯è°ƒåº¦æ˜¯å¦ç”Ÿæ•ˆï¼š

```sql
SELECT 
  ts.id,
  t.task_name,
  ts.schedule_type,
  ts.schedule_config,
  ts.next_run_time,
  ts.is_active,
  ts.create_time
FROM task_schedules ts
JOIN tasks t ON ts.task_id = t.id
WHERE ts.is_active = TRUE
ORDER BY ts.next_run_time;
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è°ƒåº¦æ‰§è¡Œè¯´æ˜](./è°ƒåº¦æ‰§è¡Œè¯´æ˜.md) - å®Œæ•´çš„è°ƒåº¦ç³»ç»Ÿæ–‡æ¡£
- [Celeryé…ç½®è¯´æ˜](./Celeryé…ç½®è¯´æ˜.md) - Celery Beat é…ç½®è¯¦è§£
- [API æ–‡æ¡£](http://localhost:8089/docs) - Swagger åœ¨çº¿æ–‡æ¡£

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2025-10-09  
**ç»´æŠ¤è€…**: Data Platform Team

